import{r as i,c as _,j as p,b as je}from"./app-CN3BbJ5b.js";import{a as K}from"./utils-Dt8dQi6c.js";import{B as Ie}from"./button-C7NEJwXC.js";import{R as Re,P as Ne,O as $e,C as Ae}from"./index-fxJJ1D40.js";import{P as R}from"./index-B2Vp4zyf.js";import{u as L}from"./index-BPocjY7g.js";import{c as V}from"./index-B_ayM8w2.js";import{S as Me}from"./search-O-6u0YIl.js";import{b as Pe,a as De,P as Fe}from"./popover-CWwjlC8R.js";import{I as Le}from"./input-DxGc0FAF.js";import{L as pe}from"./label-BAmIZs5g.js";import{S as _e}from"./spinner-BJMYT9YU.js";import{c as Ke}from"./index-CZjjwbrG.js";import{C as Be}from"./calendar-D5oWVwJF.js";import{C as Oe}from"./chevrons-up-down-Je0y-Cb2.js";import{C as qe}from"./check-Bm50D4KV.js";/* empty css            */import"./index-DaLjAgKf.js";import"./index-BpvnwpBx.js";import"./index-HyMYkPDM.js";import"./index-B2-ZojZD.js";import"./createLucideIcon-Cvhmgf6U.js";import"./index-BTIXps0c.js";import"./index-Zn1P3asn.js";import"./loader-circle-yCDM4bKH.js";import"./index-CMWG4mbA.js";var ve=1,Ve=.9,ze=.8,Ue=.17,te=.1,re=.999,Ge=.9999,Te=.99,He=/[\\\/_+.#"@\[\(\{&]/,We=/[\\\/_+.#"@\[\(\{&]/g,Je=/[\s-]/,xe=/[\s-]/g;function le(r,e,t,a,l,o,c){if(o===e.length)return l===r.length?ve:Te;var m=`${l},${o}`;if(c[m]!==void 0)return c[m];for(var x=a.charAt(o),u=t.indexOf(x,l),v=0,g,S,k,b;u>=0;)g=le(r,e,t,a,u+1,o+1,c),g>v&&(u===l?g*=ve:He.test(r.charAt(u-1))?(g*=ze,k=r.slice(l,u-1).match(We),k&&l>0&&(g*=Math.pow(re,k.length))):Je.test(r.charAt(u-1))?(g*=Ve,b=r.slice(l,u-1).match(xe),b&&l>0&&(g*=Math.pow(re,b.length))):(g*=Ue,l>0&&(g*=Math.pow(re,u-l))),r.charAt(u)!==e.charAt(o)&&(g*=Ge)),(g<te&&t.charAt(u-1)===a.charAt(o+1)||a.charAt(o+1)===a.charAt(o)&&t.charAt(u-1)!==a.charAt(o))&&(S=le(r,e,t,a,u+1,o+2,c),S*te>g&&(g=S*te)),g>v&&(v=g),u=t.indexOf(x,u+1);return c[m]=v,v}function he(r){return r.toLowerCase().replace(xe," ")}function Xe(r,e,t){return r=t&&t.length>0?`${r+" "+t.join(" ")}`:r,le(r,e,he(r),he(e),0,0,{})}var q='[cmdk-group=""]',ne='[cmdk-group-items=""]',Ye='[cmdk-group-heading=""]',be='[cmdk-item=""]',ge=`${be}:not([aria-disabled="true"])`,ae="cmdk-item-select",D="data-value",Qe=(r,e,t)=>Xe(r,e,t),ye=i.createContext(void 0),z=()=>i.useContext(ye),we=i.createContext(void 0),oe=()=>i.useContext(we),ke=i.createContext(void 0),Se=i.forwardRef((r,e)=>{let t=F(()=>{var n,d;return{search:"",value:(d=(n=r.value)!=null?n:r.defaultValue)!=null?d:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),a=F(()=>new Set),l=F(()=>new Map),o=F(()=>new Map),c=F(()=>new Set),m=Ee(r),{label:x,children:u,value:v,onValueChange:g,filter:S,shouldFilter:k,loop:b,disablePointerSelection:N=!1,vimBindings:$=!0,...U}=r,H=L(),ie=L(),W=L(),A=i.useRef(null),w=ut();M(()=>{if(v!==void 0){let n=v.trim();t.current.value=n,C.emit()}},[v]),M(()=>{w(6,ue)},[]);let C=i.useMemo(()=>({subscribe:n=>(c.current.add(n),()=>c.current.delete(n)),snapshot:()=>t.current,setState:(n,d,f)=>{var s,h,y,j;if(!Object.is(t.current[n],d)){if(t.current[n]=d,n==="search")Q(),X(),w(1,Y);else if(n==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let E=document.getElementById(W);E?E.focus():(s=document.getElementById(H))==null||s.focus()}if(w(7,()=>{var E;t.current.selectedItemId=(E=P())==null?void 0:E.id,C.emit()}),f||w(5,ue),((h=m.current)==null?void 0:h.value)!==void 0){let E=d??"";(j=(y=m.current).onValueChange)==null||j.call(y,E);return}}C.emit()}},emit:()=>{c.current.forEach(n=>n())}}),[]),J=i.useMemo(()=>({value:(n,d,f)=>{var s;d!==((s=o.current.get(n))==null?void 0:s.value)&&(o.current.set(n,{value:d,keywords:f}),t.current.filtered.items.set(n,se(d,f)),w(2,()=>{X(),C.emit()}))},item:(n,d)=>(a.current.add(n),d&&(l.current.has(d)?l.current.get(d).add(n):l.current.set(d,new Set([n]))),w(3,()=>{Q(),X(),t.current.value||Y(),C.emit()}),()=>{o.current.delete(n),a.current.delete(n),t.current.filtered.items.delete(n);let f=P();w(4,()=>{Q(),f?.getAttribute("id")===n&&Y(),C.emit()})}),group:n=>(l.current.has(n)||l.current.set(n,new Set),()=>{o.current.delete(n),l.current.delete(n)}),filter:()=>m.current.shouldFilter,label:x||r["aria-label"],getDisablePointerSelection:()=>m.current.disablePointerSelection,listId:H,inputId:W,labelId:ie,listInnerRef:A}),[]);function se(n,d){var f,s;let h=(s=(f=m.current)==null?void 0:f.filter)!=null?s:Qe;return n?h(n,t.current.search,d):0}function X(){if(!t.current.search||m.current.shouldFilter===!1)return;let n=t.current.filtered.items,d=[];t.current.filtered.groups.forEach(s=>{let h=l.current.get(s),y=0;h.forEach(j=>{let E=n.get(j);y=Math.max(E,y)}),d.push([s,y])});let f=A.current;O().sort((s,h)=>{var y,j;let E=s.getAttribute("id"),G=h.getAttribute("id");return((y=n.get(G))!=null?y:0)-((j=n.get(E))!=null?j:0)}).forEach(s=>{let h=s.closest(ne);h?h.appendChild(s.parentElement===h?s:s.closest(`${ne} > *`)):f.appendChild(s.parentElement===f?s:s.closest(`${ne} > *`))}),d.sort((s,h)=>h[1]-s[1]).forEach(s=>{var h;let y=(h=A.current)==null?void 0:h.querySelector(`${q}[${D}="${encodeURIComponent(s[0])}"]`);y?.parentElement.appendChild(y)})}function Y(){let n=O().find(f=>f.getAttribute("aria-disabled")!=="true"),d=n?.getAttribute(D);C.setState("value",d||void 0)}function Q(){var n,d,f,s;if(!t.current.search||m.current.shouldFilter===!1){t.current.filtered.count=a.current.size;return}t.current.filtered.groups=new Set;let h=0;for(let y of a.current){let j=(d=(n=o.current.get(y))==null?void 0:n.value)!=null?d:"",E=(s=(f=o.current.get(y))==null?void 0:f.keywords)!=null?s:[],G=se(j,E);t.current.filtered.items.set(y,G),G>0&&h++}for(let[y,j]of l.current)for(let E of j)if(t.current.filtered.items.get(E)>0){t.current.filtered.groups.add(y);break}t.current.filtered.count=h}function ue(){var n,d,f;let s=P();s&&(((n=s.parentElement)==null?void 0:n.firstChild)===s&&((f=(d=s.closest(q))==null?void 0:d.querySelector(Ye))==null||f.scrollIntoView({block:"nearest"})),s.scrollIntoView({block:"nearest"}))}function P(){var n;return(n=A.current)==null?void 0:n.querySelector(`${be}[aria-selected="true"]`)}function O(){var n;return Array.from(((n=A.current)==null?void 0:n.querySelectorAll(ge))||[])}function Z(n){let d=O()[n];d&&C.setState("value",d.getAttribute(D))}function ee(n){var d;let f=P(),s=O(),h=s.findIndex(j=>j===f),y=s[h+n];(d=m.current)!=null&&d.loop&&(y=h+n<0?s[s.length-1]:h+n===s.length?s[0]:s[h+n]),y&&C.setState("value",y.getAttribute(D))}function ce(n){let d=P(),f=d?.closest(q),s;for(;f&&!s;)f=n>0?it(f,q):st(f,q),s=f?.querySelector(ge);s?C.setState("value",s.getAttribute(D)):ee(n)}let de=()=>Z(O().length-1),me=n=>{n.preventDefault(),n.metaKey?de():n.altKey?ce(1):ee(1)},fe=n=>{n.preventDefault(),n.metaKey?Z(0):n.altKey?ce(-1):ee(-1)};return i.createElement(R.div,{ref:e,tabIndex:-1,...U,"cmdk-root":"",onKeyDown:n=>{var d;(d=U.onKeyDown)==null||d.call(U,n);let f=n.nativeEvent.isComposing||n.keyCode===229;if(!(n.defaultPrevented||f))switch(n.key){case"n":case"j":{$&&n.ctrlKey&&me(n);break}case"ArrowDown":{me(n);break}case"p":case"k":{$&&n.ctrlKey&&fe(n);break}case"ArrowUp":{fe(n);break}case"Home":{n.preventDefault(),Z(0);break}case"End":{n.preventDefault(),de();break}case"Enter":{n.preventDefault();let s=P();if(s){let h=new Event(ae);s.dispatchEvent(h)}}}}},i.createElement("label",{"cmdk-label":"",htmlFor:J.inputId,id:J.labelId,style:dt},x),T(r,n=>i.createElement(we.Provider,{value:C},i.createElement(ye.Provider,{value:J},n))))}),Ze=i.forwardRef((r,e)=>{var t,a;let l=L(),o=i.useRef(null),c=i.useContext(ke),m=z(),x=Ee(r),u=(a=(t=x.current)==null?void 0:t.forceMount)!=null?a:c?.forceMount;M(()=>{if(!u)return m.item(l,c?.id)},[u]);let v=Ce(l,o,[r.value,r.children,o],r.keywords),g=oe(),S=I(w=>w.value&&w.value===v.current),k=I(w=>u||m.filter()===!1?!0:w.search?w.filtered.items.get(l)>0:!0);i.useEffect(()=>{let w=o.current;if(!(!w||r.disabled))return w.addEventListener(ae,b),()=>w.removeEventListener(ae,b)},[k,r.onSelect,r.disabled]);function b(){var w,C;N(),(C=(w=x.current).onSelect)==null||C.call(w,v.current)}function N(){g.setState("value",v.current,!0)}if(!k)return null;let{disabled:$,value:U,onSelect:H,forceMount:ie,keywords:W,...A}=r;return i.createElement(R.div,{ref:V(o,e),...A,id:l,"cmdk-item":"",role:"option","aria-disabled":!!$,"aria-selected":!!S,"data-disabled":!!$,"data-selected":!!S,onPointerMove:$||m.getDisablePointerSelection()?void 0:N,onClick:$?void 0:b},r.children)}),et=i.forwardRef((r,e)=>{let{heading:t,children:a,forceMount:l,...o}=r,c=L(),m=i.useRef(null),x=i.useRef(null),u=L(),v=z(),g=I(k=>l||v.filter()===!1?!0:k.search?k.filtered.groups.has(c):!0);M(()=>v.group(c),[]),Ce(c,m,[r.value,r.heading,x]);let S=i.useMemo(()=>({id:c,forceMount:l}),[l]);return i.createElement(R.div,{ref:V(m,e),...o,"cmdk-group":"",role:"presentation",hidden:g?void 0:!0},t&&i.createElement("div",{ref:x,"cmdk-group-heading":"","aria-hidden":!0,id:u},t),T(r,k=>i.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":t?u:void 0},i.createElement(ke.Provider,{value:S},k))))}),tt=i.forwardRef((r,e)=>{let{alwaysRender:t,...a}=r,l=i.useRef(null),o=I(c=>!c.search);return!t&&!o?null:i.createElement(R.div,{ref:V(l,e),...a,"cmdk-separator":"",role:"separator"})}),rt=i.forwardRef((r,e)=>{let{onValueChange:t,...a}=r,l=r.value!=null,o=oe(),c=I(u=>u.search),m=I(u=>u.selectedItemId),x=z();return i.useEffect(()=>{r.value!=null&&o.setState("search",r.value)},[r.value]),i.createElement(R.input,{ref:e,...a,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":x.listId,"aria-labelledby":x.labelId,"aria-activedescendant":m,id:x.inputId,type:"text",value:l?r.value:c,onChange:u=>{l||o.setState("search",u.target.value),t?.(u.target.value)}})}),nt=i.forwardRef((r,e)=>{let{children:t,label:a="Suggestions",...l}=r,o=i.useRef(null),c=i.useRef(null),m=I(u=>u.selectedItemId),x=z();return i.useEffect(()=>{if(c.current&&o.current){let u=c.current,v=o.current,g,S=new ResizeObserver(()=>{g=requestAnimationFrame(()=>{let k=u.offsetHeight;v.style.setProperty("--cmdk-list-height",k.toFixed(1)+"px")})});return S.observe(u),()=>{cancelAnimationFrame(g),S.unobserve(u)}}},[]),i.createElement(R.div,{ref:V(o,e),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":m,"aria-label":a,id:x.listId},T(r,u=>i.createElement("div",{ref:V(c,x.listInnerRef),"cmdk-list-sizer":""},u)))}),lt=i.forwardRef((r,e)=>{let{open:t,onOpenChange:a,overlayClassName:l,contentClassName:o,container:c,...m}=r;return i.createElement(Re,{open:t,onOpenChange:a},i.createElement(Ne,{container:c},i.createElement($e,{"cmdk-overlay":"",className:l}),i.createElement(Ae,{"aria-label":r.label,"cmdk-dialog":"",className:o},i.createElement(Se,{ref:e,...m}))))}),at=i.forwardRef((r,e)=>I(t=>t.filtered.count===0)?i.createElement(R.div,{ref:e,...r,"cmdk-empty":"",role:"presentation"}):null),ot=i.forwardRef((r,e)=>{let{progress:t,children:a,label:l="Loading...",...o}=r;return i.createElement(R.div,{ref:e,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},T(r,c=>i.createElement("div",{"aria-hidden":!0},c)))}),B=Object.assign(Se,{List:nt,Item:Ze,Input:rt,Group:et,Separator:tt,Dialog:lt,Empty:at,Loading:ot});function it(r,e){let t=r.nextElementSibling;for(;t;){if(t.matches(e))return t;t=t.nextElementSibling}}function st(r,e){let t=r.previousElementSibling;for(;t;){if(t.matches(e))return t;t=t.previousElementSibling}}function Ee(r){let e=i.useRef(r);return M(()=>{e.current=r}),e}var M=typeof window>"u"?i.useEffect:i.useLayoutEffect;function F(r){let e=i.useRef();return e.current===void 0&&(e.current=r()),e}function I(r){let e=oe(),t=()=>r(e.snapshot());return i.useSyncExternalStore(e.subscribe,t,t)}function Ce(r,e,t,a=[]){let l=i.useRef(),o=z();return M(()=>{var c;let m=(()=>{var u;for(let v of t){if(typeof v=="string")return v.trim();if(typeof v=="object"&&"current"in v)return v.current?(u=v.current.textContent)==null?void 0:u.trim():l.current}})(),x=a.map(u=>u.trim());o.value(r,m,x),(c=e.current)==null||c.setAttribute(D,m),l.current=m}),l}var ut=()=>{let[r,e]=i.useState(),t=F(()=>new Map);return M(()=>{t.current.forEach(a=>a()),t.current=new Map},[r]),(a,l)=>{t.current.set(a,l),e({})}};function ct(r){let e=r.type;return typeof e=="function"?e(r.props):"render"in e?e.render(r.props):r}function T({asChild:r,children:e},t){return r&&i.isValidElement(e)?i.cloneElement(ct(e),{ref:e.ref},t(e.props.children)):t(e)}var dt={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function mt(r){const e=_.c(8);let t,a;e[0]!==r?({className:t,...a}=r,e[0]=r,e[1]=t,e[2]=a):(t=e[1],a=e[2]);let l;e[3]!==t?(l=K("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",t),e[3]=t,e[4]=l):l=e[4];let o;return e[5]!==a||e[6]!==l?(o=p.jsx(B,{"data-slot":"command",className:l,...a}),e[5]=a,e[6]=l,e[7]=o):o=e[7],o}function ft(r){const e=_.c(9);let t,a;e[0]!==r?({className:t,...a}=r,e[0]=r,e[1]=t,e[2]=a):(t=e[1],a=e[2]);let l;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=p.jsx(Me,{className:"size-4 shrink-0 opacity-50"}),e[3]=l):l=e[3];let o;e[4]!==t?(o=K("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",t),e[4]=t,e[5]=o):o=e[5];let c;return e[6]!==a||e[7]!==o?(c=p.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[l,p.jsx(B.Input,{"data-slot":"command-input",className:o,...a})]}),e[6]=a,e[7]=o,e[8]=c):c=e[8],c}function pt(r){const e=_.c(8);let t,a;e[0]!==r?({className:t,...a}=r,e[0]=r,e[1]=t,e[2]=a):(t=e[1],a=e[2]);let l;e[3]!==t?(l=K("max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto",t),e[3]=t,e[4]=l):l=e[4];let o;return e[5]!==a||e[6]!==l?(o=p.jsx(B.List,{"data-slot":"command-list",className:l,...a}),e[5]=a,e[6]=l,e[7]=o):o=e[7],o}function vt(r){const e=_.c(4);let t;e[0]!==r?({...t}=r,e[0]=r,e[1]=t):t=e[1];let a;return e[2]!==t?(a=p.jsx(B.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...t}),e[2]=t,e[3]=a):a=e[3],a}function ht(r){const e=_.c(8);let t,a;e[0]!==r?({className:t,...a}=r,e[0]=r,e[1]=t,e[2]=a):(t=e[1],a=e[2]);let l;e[3]!==t?(l=K("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",t),e[3]=t,e[4]=l):l=e[4];let o;return e[5]!==a||e[6]!==l?(o=p.jsx(B.Group,{"data-slot":"command-group",className:l,...a}),e[5]=a,e[6]=l,e[7]=o):o=e[7],o}function gt(r){const e=_.c(8);let t,a;e[0]!==r?({className:t,...a}=r,e[0]=r,e[1]=t,e[2]=a):(t=e[1],a=e[2]);let l;e[3]!==t?(l=K("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),e[3]=t,e[4]=l):l=e[4];let o;return e[5]!==a||e[6]!==l?(o=p.jsx(B.Item,{"data-slot":"command-item",className:l,...a}),e[5]=a,e[6]=l,e[7]=o):o=e[7],o}function Ut({value:r,birthday:e,onBirthdayChange:t,onSelect:a,error:l,newlyCreatedPatient:o}){const[c,m]=i.useState(!1),[x,u]=i.useState(!1),[v,g]=i.useState([]),S=i.useCallback(async b=>{if(b){u(!0);try{const N=await je.get(Ke.patient.byBirthday().url,{params:{birthday:b}});g(N.data)}catch(N){console.error("Failed to load patients",N)}finally{u(!1)}}},[]);i.useEffect(()=>{e&&S(e)},[e,S]);const k=v.find(b=>b.id.toString()===r)||(o?.id.toString()===r?o:null);return p.jsxs("div",{className:"space-y-4 p-4 border rounded-xl bg-muted/30",children:[p.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[p.jsxs("div",{className:"space-y-1",children:[p.jsx(pe,{className:"text-xs font-bold uppercase text-muted-foreground",children:"1. Filter by Birthday"}),p.jsxs("div",{className:"relative",children:[p.jsx(Be,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),p.jsx(Le,{type:"date",className:"pl-8",value:e,onChange:b=>{t(b.target.value),a("")}})]})]}),p.jsxs("div",{className:"space-y-1",children:[p.jsx(pe,{className:"text-xs font-bold uppercase text-muted-foreground",children:"2. Select Patient"}),p.jsxs(Pe,{open:c,onOpenChange:m,children:[p.jsx(De,{asChild:!0,children:p.jsxs(Ie,{variant:"outline",role:"combobox","aria-expanded":c,className:"w-full justify-between",disabled:!e||x,children:[x?p.jsx(_e,{className:"mr-2 h-4 w-4"}):k?`${k.first_name} ${k.last_name}`:"Select patient...",p.jsx(Oe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),p.jsx(Fe,{className:"w-full p-0",align:"start",children:p.jsxs(mt,{children:[p.jsx(ft,{placeholder:"Search by name..."}),p.jsxs(pt,{children:[p.jsx(vt,{children:"No patient found for this date."}),p.jsx(ht,{children:v.map(b=>p.jsxs(gt,{value:`${b.first_name} ${b.last_name}`,onSelect:()=>{a(b.id.toString()),m(!1)},children:[p.jsx(qe,{className:K("mr-2 h-4 w-4",r===b.id.toString()?"opacity-100":"opacity-0")}),b.first_name," ",b.last_name]},b.id))})]})]})})]})]})]}),l&&p.jsx("p",{className:"text-sm text-red-500 mt-1",children:l})]})}export{Ut as PatientSelector};
